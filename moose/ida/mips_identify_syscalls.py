#!/usr/bin/env python
#
# Code related to ESET's Linux/Moose research
# For feedback or questions contact us at: github@eset.com
# https://github.com/eset/malware-research/
#
# This code is provided to the community under the two-clause BSD license as
# follows:
#
# Copyright (C) 2015 ESET
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
#
# 1. Redistributions of source code must retain the above copyright notice, this
# list of conditions and the following disclaimer.
#
# 2. Redistributions in binary form must reproduce the above copyright notice,
# this list of conditions and the following disclaimer in the documentation
# and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
# DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
# FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
# SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
# OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# Olivier Bilodeau <bilodeau@eset.com>
#
# Place a comment in IDA describing the syscall for MIPS with o32 ABI
#
# example syscall:
# move    $a0, $s0
# li      $a1, 9
# li      $v0, 4037
# syscall 0          # kill
# 4037 is the syscall number which is kill
#
DEBUG = False

# syscalls taken from:
# http://git.linux-mips.org/cgit/ralf/linux.git/plain/arch/mips/include/uapi/asm/unistd.h
# and processed with syscalls-to-dict.sh and then inlined here

__NR_Linux = 4000
syscall_table = dict()
syscall_table[(__NR_Linux+0)] = "__NR_syscall"
syscall_table[(__NR_Linux+1)] = "__NR_exit"
syscall_table[(__NR_Linux+2)] = "__NR_fork"
syscall_table[(__NR_Linux+3)] = "__NR_read"
syscall_table[(__NR_Linux+4)] = "__NR_write"
syscall_table[(__NR_Linux+5)] = "__NR_open"
syscall_table[(__NR_Linux+6)] = "__NR_close"
syscall_table[(__NR_Linux+7)] = "__NR_waitpid"
syscall_table[(__NR_Linux+8)] = "__NR_creat"
syscall_table[(__NR_Linux+9)] = "__NR_link"
syscall_table[(__NR_Linux+10)] = "__NR_unlink"
syscall_table[(__NR_Linux+11)] = "__NR_execve"
syscall_table[(__NR_Linux+12)] = "__NR_chdir"
syscall_table[(__NR_Linux+13)] = "__NR_time"
syscall_table[(__NR_Linux+14)] = "__NR_mknod"
syscall_table[(__NR_Linux+15)] = "__NR_chmod"
syscall_table[(__NR_Linux+16)] = "__NR_lchown"
syscall_table[(__NR_Linux+17)] = "__NR_break"
syscall_table[(__NR_Linux+18)] = "__NR_unused18"
syscall_table[(__NR_Linux+19)] = "__NR_lseek"
syscall_table[(__NR_Linux+20)] = "__NR_getpid"
syscall_table[(__NR_Linux+21)] = "__NR_mount"
syscall_table[(__NR_Linux+22)] = "__NR_umount"
syscall_table[(__NR_Linux+23)] = "__NR_setuid"
syscall_table[(__NR_Linux+24)] = "__NR_getuid"
syscall_table[(__NR_Linux+25)] = "__NR_stime"
syscall_table[(__NR_Linux+26)] = "__NR_ptrace"
syscall_table[(__NR_Linux+27)] = "__NR_alarm"
syscall_table[(__NR_Linux+28)] = "__NR_unused28"
syscall_table[(__NR_Linux+29)] = "__NR_pause"
syscall_table[(__NR_Linux+30)] = "__NR_utime"
syscall_table[(__NR_Linux+31)] = "__NR_stty"
syscall_table[(__NR_Linux+32)] = "__NR_gtty"
syscall_table[(__NR_Linux+33)] = "__NR_access"
syscall_table[(__NR_Linux+34)] = "__NR_nice"
syscall_table[(__NR_Linux+35)] = "__NR_ftime"
syscall_table[(__NR_Linux+36)] = "__NR_sync"
syscall_table[(__NR_Linux+37)] = "__NR_kill"
syscall_table[(__NR_Linux+38)] = "__NR_rename"
syscall_table[(__NR_Linux+39)] = "__NR_mkdir"
syscall_table[(__NR_Linux+40)] = "__NR_rmdir"
syscall_table[(__NR_Linux+41)] = "__NR_dup"
syscall_table[(__NR_Linux+42)] = "__NR_pipe"
syscall_table[(__NR_Linux+43)] = "__NR_times"
syscall_table[(__NR_Linux+44)] = "__NR_prof"
syscall_table[(__NR_Linux+45)] = "__NR_brk"
syscall_table[(__NR_Linux+46)] = "__NR_setgid"
syscall_table[(__NR_Linux+47)] = "__NR_getgid"
syscall_table[(__NR_Linux+48)] = "__NR_signal"
syscall_table[(__NR_Linux+49)] = "__NR_geteuid"
syscall_table[(__NR_Linux+50)] = "__NR_getegid"
syscall_table[(__NR_Linux+51)] = "__NR_acct"
syscall_table[(__NR_Linux+52)] = "__NR_umount2"
syscall_table[(__NR_Linux+53)] = "__NR_lock"
syscall_table[(__NR_Linux+54)] = "__NR_ioctl"
syscall_table[(__NR_Linux+55)] = "__NR_fcntl"
syscall_table[(__NR_Linux+56)] = "__NR_mpx"
syscall_table[(__NR_Linux+57)] = "__NR_setpgid"
syscall_table[(__NR_Linux+58)] = "__NR_ulimit"
syscall_table[(__NR_Linux+59)] = "__NR_unused59"
syscall_table[(__NR_Linux+60)] = "__NR_umask"
syscall_table[(__NR_Linux+61)] = "__NR_chroot"
syscall_table[(__NR_Linux+62)] = "__NR_ustat"
syscall_table[(__NR_Linux+63)] = "__NR_dup2"
syscall_table[(__NR_Linux+64)] = "__NR_getppid"
syscall_table[(__NR_Linux+65)] = "__NR_getpgrp"
syscall_table[(__NR_Linux+66)] = "__NR_setsid"
syscall_table[(__NR_Linux+67)] = "__NR_sigaction"
syscall_table[(__NR_Linux+68)] = "__NR_sgetmask"
syscall_table[(__NR_Linux+69)] = "__NR_ssetmask"
syscall_table[(__NR_Linux+70)] = "__NR_setreuid"
syscall_table[(__NR_Linux+71)] = "__NR_setregid"
syscall_table[(__NR_Linux+72)] = "__NR_sigsuspend"
syscall_table[(__NR_Linux+73)] = "__NR_sigpending"
syscall_table[(__NR_Linux+74)] = "__NR_sethostname"
syscall_table[(__NR_Linux+75)] = "__NR_setrlimit"
syscall_table[(__NR_Linux+76)] = "__NR_getrlimit"
syscall_table[(__NR_Linux+77)] = "__NR_getrusage"
syscall_table[(__NR_Linux+78)] = "__NR_gettimeofday"
syscall_table[(__NR_Linux+79)] = "__NR_settimeofday"
syscall_table[(__NR_Linux+80)] = "__NR_getgroups"
syscall_table[(__NR_Linux+81)] = "__NR_setgroups"
syscall_table[(__NR_Linux+82)] = "__NR_reserved82"
syscall_table[(__NR_Linux+83)] = "__NR_symlink"
syscall_table[(__NR_Linux+84)] = "__NR_unused84"
syscall_table[(__NR_Linux+85)] = "__NR_readlink"
syscall_table[(__NR_Linux+86)] = "__NR_uselib"
syscall_table[(__NR_Linux+87)] = "__NR_swapon"
syscall_table[(__NR_Linux+88)] = "__NR_reboot"
syscall_table[(__NR_Linux+89)] = "__NR_readdir"
syscall_table[(__NR_Linux+90)] = "__NR_mmap"
syscall_table[(__NR_Linux+91)] = "__NR_munmap"
syscall_table[(__NR_Linux+92)] = "__NR_truncate"
syscall_table[(__NR_Linux+93)] = "__NR_ftruncate"
syscall_table[(__NR_Linux+94)] = "__NR_fchmod"
syscall_table[(__NR_Linux+95)] = "__NR_fchown"
syscall_table[(__NR_Linux+96)] = "__NR_getpriority"
syscall_table[(__NR_Linux+97)] = "__NR_setpriority"
syscall_table[(__NR_Linux+98)] = "__NR_profil"
syscall_table[(__NR_Linux+99)] = "__NR_statfs"
syscall_table[(__NR_Linux+100)] = "__NR_fstatfs"
syscall_table[(__NR_Linux+101)] = "__NR_ioperm"
syscall_table[(__NR_Linux+102)] = "__NR_socketcall"
syscall_table[(__NR_Linux+103)] = "__NR_syslog"
syscall_table[(__NR_Linux+104)] = "__NR_setitimer"
syscall_table[(__NR_Linux+105)] = "__NR_getitimer"
syscall_table[(__NR_Linux+106)] = "__NR_stat"
syscall_table[(__NR_Linux+107)] = "__NR_lstat"
syscall_table[(__NR_Linux+108)] = "__NR_fstat"
syscall_table[(__NR_Linux+109)] = "__NR_unused109"
syscall_table[(__NR_Linux+110)] = "__NR_iopl"
syscall_table[(__NR_Linux+111)] = "__NR_vhangup"
syscall_table[(__NR_Linux+112)] = "__NR_idle"
syscall_table[(__NR_Linux+113)] = "__NR_vm86"
syscall_table[(__NR_Linux+114)] = "__NR_wait4"
syscall_table[(__NR_Linux+115)] = "__NR_swapoff"
syscall_table[(__NR_Linux+116)] = "__NR_sysinfo"
syscall_table[(__NR_Linux+117)] = "__NR_ipc"
syscall_table[(__NR_Linux+118)] = "__NR_fsync"
syscall_table[(__NR_Linux+119)] = "__NR_sigreturn"
syscall_table[(__NR_Linux+120)] = "__NR_clone"
syscall_table[(__NR_Linux+121)] = "__NR_setdomainname"
syscall_table[(__NR_Linux+122)] = "__NR_uname"
syscall_table[(__NR_Linux+123)] = "__NR_modify_ldt"
syscall_table[(__NR_Linux+124)] = "__NR_adjtimex"
syscall_table[(__NR_Linux+125)] = "__NR_mprotect"
syscall_table[(__NR_Linux+126)] = "__NR_sigprocmask"
syscall_table[(__NR_Linux+127)] = "__NR_create_module"
syscall_table[(__NR_Linux+128)] = "__NR_init_module"
syscall_table[(__NR_Linux+129)] = "__NR_delete_module"
syscall_table[(__NR_Linux+130)] = "__NR_get_kernel_syms"
syscall_table[(__NR_Linux+131)] = "__NR_quotactl"
syscall_table[(__NR_Linux+132)] = "__NR_getpgid"
syscall_table[(__NR_Linux+133)] = "__NR_fchdir"
syscall_table[(__NR_Linux+134)] = "__NR_bdflush"
syscall_table[(__NR_Linux+135)] = "__NR_sysfs"
syscall_table[(__NR_Linux+136)] = "__NR_personality"
syscall_table[(__NR_Linux+137)] = "__NR_afs_syscall"
syscall_table[(__NR_Linux+138)] = "__NR_setfsuid"
syscall_table[(__NR_Linux+139)] = "__NR_setfsgid"
syscall_table[(__NR_Linux+140)] = "__NR__llseek"
syscall_table[(__NR_Linux+141)] = "__NR_getdents"
syscall_table[(__NR_Linux+142)] = "__NR__newselect"
syscall_table[(__NR_Linux+143)] = "__NR_flock"
syscall_table[(__NR_Linux+144)] = "__NR_msync"
syscall_table[(__NR_Linux+145)] = "__NR_readv"
syscall_table[(__NR_Linux+146)] = "__NR_writev"
syscall_table[(__NR_Linux+147)] = "__NR_cacheflush"
syscall_table[(__NR_Linux+148)] = "__NR_cachectl"
syscall_table[(__NR_Linux+149)] = "__NR_sysmips"
syscall_table[(__NR_Linux+150)] = "__NR_unused150"
syscall_table[(__NR_Linux+151)] = "__NR_getsid"
syscall_table[(__NR_Linux+152)] = "__NR_fdatasync"
syscall_table[(__NR_Linux+153)] = "__NR__sysctl"
syscall_table[(__NR_Linux+154)] = "__NR_mlock"
syscall_table[(__NR_Linux+155)] = "__NR_munlock"
syscall_table[(__NR_Linux+156)] = "__NR_mlockall"
syscall_table[(__NR_Linux+157)] = "__NR_munlockall"
syscall_table[(__NR_Linux+158)] = "__NR_sched_setparam"
syscall_table[(__NR_Linux+159)] = "__NR_sched_getparam"
syscall_table[(__NR_Linux+160)] = "__NR_sched_setscheduler"
syscall_table[(__NR_Linux+161)] = "__NR_sched_getscheduler"
syscall_table[(__NR_Linux+162)] = "__NR_sched_yield"
syscall_table[(__NR_Linux+163)] = "__NR_sched_get_priority_max"
syscall_table[(__NR_Linux+164)] = "__NR_sched_get_priority_min"
syscall_table[(__NR_Linux+165)] = "__NR_sched_rr_get_interval"
syscall_table[(__NR_Linux+166)] = "__NR_nanosleep"
syscall_table[(__NR_Linux+167)] = "__NR_mremap"
syscall_table[(__NR_Linux+168)] = "__NR_accept"
syscall_table[(__NR_Linux+169)] = "__NR_bind"
syscall_table[(__NR_Linux+170)] = "__NR_connect"
syscall_table[(__NR_Linux+171)] = "__NR_getpeername"
syscall_table[(__NR_Linux+172)] = "__NR_getsockname"
syscall_table[(__NR_Linux+173)] = "__NR_getsockopt"
syscall_table[(__NR_Linux+174)] = "__NR_listen"
syscall_table[(__NR_Linux+175)] = "__NR_recv"
syscall_table[(__NR_Linux+176)] = "__NR_recvfrom"
syscall_table[(__NR_Linux+177)] = "__NR_recvmsg"
syscall_table[(__NR_Linux+178)] = "__NR_send"
syscall_table[(__NR_Linux+179)] = "__NR_sendmsg"
syscall_table[(__NR_Linux+180)] = "__NR_sendto"
syscall_table[(__NR_Linux+181)] = "__NR_setsockopt"
syscall_table[(__NR_Linux+182)] = "__NR_shutdown"
syscall_table[(__NR_Linux+183)] = "__NR_socket"
syscall_table[(__NR_Linux+184)] = "__NR_socketpair"
syscall_table[(__NR_Linux+185)] = "__NR_setresuid"
syscall_table[(__NR_Linux+186)] = "__NR_getresuid"
syscall_table[(__NR_Linux+187)] = "__NR_query_module"
syscall_table[(__NR_Linux+188)] = "__NR_poll"
syscall_table[(__NR_Linux+189)] = "__NR_nfsservctl"
syscall_table[(__NR_Linux+190)] = "__NR_setresgid"
syscall_table[(__NR_Linux+191)] = "__NR_getresgid"
syscall_table[(__NR_Linux+192)] = "__NR_prctl"
syscall_table[(__NR_Linux+193)] = "__NR_rt_sigreturn"
syscall_table[(__NR_Linux+194)] = "__NR_rt_sigaction"
syscall_table[(__NR_Linux+195)] = "__NR_rt_sigprocmask"
syscall_table[(__NR_Linux+196)] = "__NR_rt_sigpending"
syscall_table[(__NR_Linux+197)] = "__NR_rt_sigtimedwait"
syscall_table[(__NR_Linux+198)] = "__NR_rt_sigqueueinfo"
syscall_table[(__NR_Linux+199)] = "__NR_rt_sigsuspend"
syscall_table[(__NR_Linux+200)] = "__NR_pread64"
syscall_table[(__NR_Linux+201)] = "__NR_pwrite64"
syscall_table[(__NR_Linux+202)] = "__NR_chown"
syscall_table[(__NR_Linux+203)] = "__NR_getcwd"
syscall_table[(__NR_Linux+204)] = "__NR_capget"
syscall_table[(__NR_Linux+205)] = "__NR_capset"
syscall_table[(__NR_Linux+206)] = "__NR_sigaltstack"
syscall_table[(__NR_Linux+207)] = "__NR_sendfile"
syscall_table[(__NR_Linux+208)] = "__NR_getpmsg"
syscall_table[(__NR_Linux+209)] = "__NR_putpmsg"
syscall_table[(__NR_Linux+210)] = "__NR_mmap2"
syscall_table[(__NR_Linux+211)] = "__NR_truncate64"
syscall_table[(__NR_Linux+212)] = "__NR_ftruncate64"
syscall_table[(__NR_Linux+213)] = "__NR_stat64"
syscall_table[(__NR_Linux+214)] = "__NR_lstat64"
syscall_table[(__NR_Linux+215)] = "__NR_fstat64"
syscall_table[(__NR_Linux+216)] = "__NR_pivot_root"
syscall_table[(__NR_Linux+217)] = "__NR_mincore"
syscall_table[(__NR_Linux+218)] = "__NR_madvise"
syscall_table[(__NR_Linux+219)] = "__NR_getdents64"
syscall_table[(__NR_Linux+220)] = "__NR_fcntl64"
syscall_table[(__NR_Linux+221)] = "__NR_reserved221"
syscall_table[(__NR_Linux+222)] = "__NR_gettid"
syscall_table[(__NR_Linux+223)] = "__NR_readahead"
syscall_table[(__NR_Linux+224)] = "__NR_setxattr"
syscall_table[(__NR_Linux+225)] = "__NR_lsetxattr"
syscall_table[(__NR_Linux+226)] = "__NR_fsetxattr"
syscall_table[(__NR_Linux+227)] = "__NR_getxattr"
syscall_table[(__NR_Linux+228)] = "__NR_lgetxattr"
syscall_table[(__NR_Linux+229)] = "__NR_fgetxattr"
syscall_table[(__NR_Linux+230)] = "__NR_listxattr"
syscall_table[(__NR_Linux+231)] = "__NR_llistxattr"
syscall_table[(__NR_Linux+232)] = "__NR_flistxattr"
syscall_table[(__NR_Linux+233)] = "__NR_removexattr"
syscall_table[(__NR_Linux+234)] = "__NR_lremovexattr"
syscall_table[(__NR_Linux+235)] = "__NR_fremovexattr"
syscall_table[(__NR_Linux+236)] = "__NR_tkill"
syscall_table[(__NR_Linux+237)] = "__NR_sendfile64"
syscall_table[(__NR_Linux+238)] = "__NR_futex"
syscall_table[(__NR_Linux+239)] = "__NR_sched_setaffinity"
syscall_table[(__NR_Linux+240)] = "__NR_sched_getaffinity"
syscall_table[(__NR_Linux+241)] = "__NR_io_setup"
syscall_table[(__NR_Linux+242)] = "__NR_io_destroy"
syscall_table[(__NR_Linux+243)] = "__NR_io_getevents"
syscall_table[(__NR_Linux+244)] = "__NR_io_submit"
syscall_table[(__NR_Linux+245)] = "__NR_io_cancel"
syscall_table[(__NR_Linux+246)] = "__NR_exit_group"
syscall_table[(__NR_Linux+247)] = "__NR_lookup_dcookie"
syscall_table[(__NR_Linux+248)] = "__NR_epoll_create"
syscall_table[(__NR_Linux+249)] = "__NR_epoll_ctl"
syscall_table[(__NR_Linux+250)] = "__NR_epoll_wait"
syscall_table[(__NR_Linux+251)] = "__NR_remap_file_pages"
syscall_table[(__NR_Linux+252)] = "__NR_set_tid_address"
syscall_table[(__NR_Linux+253)] = "__NR_restart_syscall"
syscall_table[(__NR_Linux+254)] = "__NR_fadvise64"
syscall_table[(__NR_Linux+255)] = "__NR_statfs64"
syscall_table[(__NR_Linux+256)] = "__NR_fstatfs64"
syscall_table[(__NR_Linux+257)] = "__NR_timer_create"
syscall_table[(__NR_Linux+258)] = "__NR_timer_settime"
syscall_table[(__NR_Linux+259)] = "__NR_timer_gettime"
syscall_table[(__NR_Linux+260)] = "__NR_timer_getoverrun"
syscall_table[(__NR_Linux+261)] = "__NR_timer_delete"
syscall_table[(__NR_Linux+262)] = "__NR_clock_settime"
syscall_table[(__NR_Linux+263)] = "__NR_clock_gettime"
syscall_table[(__NR_Linux+264)] = "__NR_clock_getres"
syscall_table[(__NR_Linux+265)] = "__NR_clock_nanosleep"
syscall_table[(__NR_Linux+266)] = "__NR_tgkill"
syscall_table[(__NR_Linux+267)] = "__NR_utimes"
syscall_table[(__NR_Linux+268)] = "__NR_mbind"
syscall_table[(__NR_Linux+269)] = "__NR_get_mempolicy"
syscall_table[(__NR_Linux+270)] = "__NR_set_mempolicy"
syscall_table[(__NR_Linux+271)] = "__NR_mq_open"
syscall_table[(__NR_Linux+272)] = "__NR_mq_unlink"
syscall_table[(__NR_Linux+273)] = "__NR_mq_timedsend"
syscall_table[(__NR_Linux+274)] = "__NR_mq_timedreceive"
syscall_table[(__NR_Linux+275)] = "__NR_mq_notify"
syscall_table[(__NR_Linux+276)] = "__NR_mq_getsetattr"
syscall_table[(__NR_Linux+277)] = "__NR_vserver"
syscall_table[(__NR_Linux+278)] = "__NR_waitid"
syscall_table[(__NR_Linux+280)] = "__NR_add_key"
syscall_table[(__NR_Linux+281)] = "__NR_request_key"
syscall_table[(__NR_Linux+282)] = "__NR_keyctl"
syscall_table[(__NR_Linux+283)] = "__NR_set_thread_area"
syscall_table[(__NR_Linux+284)] = "__NR_inotify_init"
syscall_table[(__NR_Linux+285)] = "__NR_inotify_add_watch"
syscall_table[(__NR_Linux+286)] = "__NR_inotify_rm_watch"
syscall_table[(__NR_Linux+287)] = "__NR_migrate_pages"
syscall_table[(__NR_Linux+288)] = "__NR_openat"
syscall_table[(__NR_Linux+289)] = "__NR_mkdirat"
syscall_table[(__NR_Linux+290)] = "__NR_mknodat"
syscall_table[(__NR_Linux+291)] = "__NR_fchownat"
syscall_table[(__NR_Linux+292)] = "__NR_futimesat"
syscall_table[(__NR_Linux+293)] = "__NR_fstatat64"
syscall_table[(__NR_Linux+294)] = "__NR_unlinkat"
syscall_table[(__NR_Linux+295)] = "__NR_renameat"
syscall_table[(__NR_Linux+296)] = "__NR_linkat"
syscall_table[(__NR_Linux+297)] = "__NR_symlinkat"
syscall_table[(__NR_Linux+298)] = "__NR_readlinkat"
syscall_table[(__NR_Linux+299)] = "__NR_fchmodat"
syscall_table[(__NR_Linux+300)] = "__NR_faccessat"
syscall_table[(__NR_Linux+301)] = "__NR_pselect6"
syscall_table[(__NR_Linux+302)] = "__NR_ppoll"
syscall_table[(__NR_Linux+303)] = "__NR_unshare"
syscall_table[(__NR_Linux+304)] = "__NR_splice"
syscall_table[(__NR_Linux+305)] = "__NR_sync_file_range"
syscall_table[(__NR_Linux+306)] = "__NR_tee"
syscall_table[(__NR_Linux+307)] = "__NR_vmsplice"
syscall_table[(__NR_Linux+308)] = "__NR_move_pages"
syscall_table[(__NR_Linux+309)] = "__NR_set_robust_list"
syscall_table[(__NR_Linux+310)] = "__NR_get_robust_list"
syscall_table[(__NR_Linux+311)] = "__NR_kexec_load"
syscall_table[(__NR_Linux+312)] = "__NR_getcpu"
syscall_table[(__NR_Linux+313)] = "__NR_epoll_pwait"
syscall_table[(__NR_Linux+314)] = "__NR_ioprio_set"
syscall_table[(__NR_Linux+315)] = "__NR_ioprio_get"
syscall_table[(__NR_Linux+316)] = "__NR_utimensat"
syscall_table[(__NR_Linux+317)] = "__NR_signalfd"
syscall_table[(__NR_Linux+318)] = "__NR_timerfd"
syscall_table[(__NR_Linux+319)] = "__NR_eventfd"
syscall_table[(__NR_Linux+320)] = "__NR_fallocate"
syscall_table[(__NR_Linux+321)] = "__NR_timerfd_create"
syscall_table[(__NR_Linux+322)] = "__NR_timerfd_gettime"
syscall_table[(__NR_Linux+323)] = "__NR_timerfd_settime"
syscall_table[(__NR_Linux+324)] = "__NR_signalfd4"
syscall_table[(__NR_Linux+325)] = "__NR_eventfd2"
syscall_table[(__NR_Linux+326)] = "__NR_epoll_create1"
syscall_table[(__NR_Linux+327)] = "__NR_dup3"
syscall_table[(__NR_Linux+328)] = "__NR_pipe2"
syscall_table[(__NR_Linux+329)] = "__NR_inotify_init1"
syscall_table[(__NR_Linux+330)] = "__NR_preadv"
syscall_table[(__NR_Linux+331)] = "__NR_pwritev"
syscall_table[(__NR_Linux+332)] = "__NR_rt_tgsigqueueinfo"
syscall_table[(__NR_Linux+333)] = "__NR_perf_event_open"
syscall_table[(__NR_Linux+334)] = "__NR_accept4"
syscall_table[(__NR_Linux+335)] = "__NR_recvmmsg"
syscall_table[(__NR_Linux+336)] = "__NR_fanotify_init"
syscall_table[(__NR_Linux+337)] = "__NR_fanotify_mark"
syscall_table[(__NR_Linux+338)] = "__NR_prlimit64"
syscall_table[(__NR_Linux+339)] = "__NR_name_to_handle_at"
syscall_table[(__NR_Linux+340)] = "__NR_open_by_handle_at"
syscall_table[(__NR_Linux+341)] = "__NR_clock_adjtime"
syscall_table[(__NR_Linux+342)] = "__NR_syncfs"
syscall_table[(__NR_Linux+343)] = "__NR_sendmmsg"
syscall_table[(__NR_Linux+344)] = "__NR_setns"
syscall_table[(__NR_Linux+345)] = "__NR_process_vm_readv"
syscall_table[(__NR_Linux+346)] = "__NR_process_vm_writev"
syscall_table[(__NR_Linux+347)] = "__NR_kcmp"
syscall_table[(__NR_Linux+348)] = "__NR_finit_module"
syscall_table[(__NR_Linux+349)] = "__NR_sched_setattr"
syscall_table[(__NR_Linux+350)] = "__NR_sched_getattr"
syscall_table[(__NR_Linux+351)] = "__NR_renameat2"
syscall_table[(__NR_Linux+352)] = "__NR_seccomp"
syscall_table[(__NR_Linux+353)] = "__NR_getrandom"
syscall_table[(__NR_Linux+354)] = "__NR_memfd_create"
syscall_table[(__NR_Linux+355)] = "__NR_bpf"

def debug(text):
    if DEBUG:
        print text

ea = ScreenEA()
seg_ea = SegStart(ea)

for addr in Heads(seg_ea, SegEnd(seg_ea)):
    if isCode(GetFlags(addr)):
        mne = GetMnem(addr)
        if mne == "syscall":

            prev_head = PrevHead(addr, seg_ea)
            if GetOpnd(prev_head, 0) == "$v0":
                # second operand is our syscall number
                syscall_id = GetOperandValue(prev_head, 1)
                if syscall_id == -1:
                    raise Exception("Invalid operand value")

                syscall = syscall_table[syscall_id]
                debug("syscall: {}/{}  at {}".format(syscall_id, syscall,
                        hex(addr)))

                # identify syscall in comments
                MakeRptCmt(addr, syscall)

            else:
                print("previous instruction is not about $v0, " \
                        "investigate: {}").format(hex(addr))
