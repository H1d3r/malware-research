meta:
  id: ol_dropper_struct
  endian: le
seq:
  - id: total_length
    type: u4
  - id: install_paths_length
    type: u4
  - id: install_paths
    type: install_paths_struct
    size: install_paths_length
  - id: binaries_length
    type: u4
  - id: binaries
    type: binaries_struct
    size: binaries_length
  - id: persistence_length
    type: u4
  - id: persistence_strings
    type: persistence_struct
    size: persistence_length

types:
  utf16_str:
    seq:
      - id: str_len
        type: u4
      - id: str_buf
        type: str
        size: str_len
        encoding: UTF-16LE
  paths_struct:
    seq:
      - id: paths
        type: utf16_str
        repeat: eos
  install_paths_struct:
    seq:
      - id: appdata_path_length
        type: u4
      - id: appdata_paths
        type: paths_struct
        size: appdata_path_length
      - id: progfile_path_length
        type: u4
      - id: progfile_paths
        type: paths_struct
        size: progfile_path_length
  binary_struct:
    seq:
      - id: binary_length
        type: u4
      - id: data
        size: binary_length
  binaries_struct:
    seq:
      - id: binary
        type: binary_struct
        repeat: eos
  persistence_struct:
    seq:
      - id: registry_persistence_length
        type: u4
      - id: regkey_str
        type: utf16_str
      - id: regvalue_str
        type: utf16_str
      - id: service_persistence_length
        type: u4
      - id: servicename_str
        type: utf16_str
      - id: displayname_str
        type: utf16_str